<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Sistema de Gestión de Estudios Médicos</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f3f4f6;
    }
    .header-bg {
      background: linear-gradient(90deg, #059669 0%, #10b981 100%);
    }
    .btn-primary {
      background-color: #059669;
      transition: all 0.3s ease;
    }
    .btn-primary:hover {
      background-color: #047857;
      transform: translateY(-2px);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .btn-secondary {
      background-color: #3b82f6;
      transition: all 0.3s ease;
    }
    .btn-secondary:hover {
      background-color: #2563eb;
      transform: translateY(-2px);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .btn-tertiary {
      background-color: #7c3aed;
      transition: all 0.3s ease;
    }
    .btn-tertiary:hover {
      background-color: #6d28d9;
      transform: translateY(-2px);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .table-row:hover {
      background-color: #f9fafb;
    }
    .status-badge {
      padding: 0.25rem 0.5rem;
      border-radius: 0.375rem;
      font-size: 0.75rem;
      font-weight: 600;
    }
    .has-report {
      background-color: #dcfce7;
      color: #166534;
    }
    .no-report {
      background-color: #fee2e2;
      color: #991b1b;
    }
    .file-input-container {
      position: relative;
      overflow: hidden;
      display: inline-block;
    }
    .file-input-container input[type="file"] {
      position: absolute;
      left: 0;
      top: 0;
      opacity: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }
    .import-section {
      background-color: #f0f9ff;
      border: 2px dashed #38bdf8;
      border-radius: 0.5rem;
      padding: 1.5rem;
      margin-top: 1rem;
    }
    .template-download {
      color: #3b82f6;
      text-decoration: underline;
      cursor: pointer;
    }
    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      font-size: 1.5rem;
      color: #059669;
    }
    .stats-card {
      background: white;
      border-radius: 0.5rem;
      padding: 1rem;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    .export-btn {
      background-color: #10b981;
      transition: all 0.3s ease;
    }
    .export-btn:hover {
      background-color: #059669;
      transform: translateY(-2px);
    }
  </style>
</head>
<body>
    <div id="root">
        <div class="loading">Cargando aplicación...</div>
    </div>

    <script type="text/babel">
        // Verificar que React esté cargado correctamente
        if (typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
            document.getElementById('root').innerHTML = `
                <div style="padding: 20px; color: red; text-align: center;">
                    <h2>Error: React no se cargó correctamente</h2>
                    <p>Por favor, verifica tu conexión a internet e intenta recargar la página.</p>
                </div>
            `;
            throw new Error('React no está disponible');
        }

        const { useState, useEffect, useMemo, useCallback } = React;

        // Componente de íconos simplificado
        const Icon = ({ name, size = 16, className = '' }) => {
          const icons = {
            Search: () => (
              <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
              </svg>
            ),
            Plus: () => (
              <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
            ),
            Save: () => (
              <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                <polyline points="17 21 17 13 7 13 7 21"></polyline>
                <polyline points="7 3 7 8 15 8"></polyline>
              </svg>
            ),
            Edit: () => (
              <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
              </svg>
            ),
            Trash2: () => (
              <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
              </svg>
            ),
            FileText: () => (
              <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <polyline points="14 2 14 8 20 8"></polyline>
                <line x1="16" y1="13" x2="8" y2="13"></line>
                <line x1="16" y1="17" x2="8" y2="17"></line>
                <polyline points="10 9 9 9 8 9"></polyline>
              </svg>
            ),
            Filter: () => (
              <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
              </svg>
            ),
            Download: () => (
              <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
              </svg>
            ),
            Upload: () => (
              <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
              </svg>
            ),
            BarChart: () => (
              <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <line x1="12" y1="20" x2="12" y2="10"></line>
                <line x1="18" y1="20" x2="18" y2="4"></line>
                <line x1="6" y1="20" x2="6" y2="16"></line>
              </svg>
            )
          };
          
          const IconComponent = icons[name];
          return IconComponent ? <IconComponent /> : null;
        };

        const MedicalStudiesApp = () => {
          // Carga inicial desde localStorage de forma perezosa
          const [studies, setStudies] = useState(() => {
            try {
              const savedStudies = localStorage.getItem('medicalStudies');
              return savedStudies ? JSON.parse(savedStudies) : [];
            } catch (error) {
              console.error('Error loading initial data:', error);
              return [];
            }
          });
          
          const [showAddForm, setShowAddForm] = useState(false);
          const [editingStudy, setEditingStudy] = useState(null);
          const [searchTerm, setSearchTerm] = useState('');
          const [filterType, setFilterType] = useState('');
          const [currentPage, setCurrentPage] = useState(1);
          const [studiesPerPage, setStudiesPerPage] = useState(50);
          const [showImportSection, setShowImportSection] = useState(false);
          const [importStatus, setImportStatus] = useState('');
          const [isLoading, setIsLoading] = useState(false);
          const [showStats, setShowStats] = useState(false);

          // Estados para el formulario
          const [formData, setFormData] = useState({
            fecha: new Date().toISOString().split('T')[0],
            admision: '',
            id: '',
            nombres: '',
            apellidos: '',
            edad: '',
            estudio: '',
            dxEst: '',
            fechaRealizacion: new Date().toISOString().split('T')[0],
            hora: '08:00',
            dia: '',
            drLector: '',
            sinInforme: false,
            articular: '',
            kristalo: '',
            synapse: '',
            solicitudes: '',
            acciones: ''
          });

          // Tipos de estudio disponibles
          const studyTypes = [
            'RX PIES', 'RX PIERNA', 'RX RODILLA', 'RX TORAX', 'TAC CRANEO', 
            'TAC RECONT', 'TAC COLUMN', 'TAC', 'TAC UROGRAF', 'RX ABDOMEN'
          ];

          const doctors = [
            'DR COLON', 'DRA HERNA', 'DR RINCON', 'DR JULIO', 'DR AVILA', 'DRA HDZ', 'DR HERAZC'
          ];

          // Guardar en localStorage cuando cambie el estado
          useEffect(() => {
            if (studies.length > 0) {
              try {
                localStorage.setItem('medicalStudies', JSON.stringify(studies));
                // Backup adicional
                localStorage.setItem('medicalStudies_backup', JSON.stringify(studies));
              } catch (error) {
                console.error('Error saving to localStorage:', error);
              }
            }
          }, [studies]);

          // Backup automático cada 5 minutos
          useEffect(() => {
            const interval = setInterval(() => {
              if (studies.length > 0) {
                try {
                  localStorage.setItem('medicalStudies_backup', JSON.stringify(studies));
                  console.log('Backup automático realizado');
                } catch (error) {
                  console.error('Error en backup automático:', error);
                }
              }
            }, 300000); // 5 minutos

            return () => clearInterval(interval);
          }, [studies]);

          // Función optimizada para generar IDs
          const generateId = useCallback(() => {
            return Date.now().toString() + Math.random().toString(36).substr(2, 9);
          }, []);

          const handleInputChange = (e) => {
            const { name, value, type, checked } = e.target;
            setFormData(prev => ({
              ...prev,
              [name]: type === 'checkbox' ? checked : value
            }));
          };

          const handleSubmit = () => {
            if (!formData.nombres || !formData.apellidos || !formData.estudio) {
              alert('Por favor complete los campos obligatorios: Nombres, Apellidos y Estudio');
              return;
            }
            
            if (editingStudy) {
              setStudies(prev => prev.map(study => 
                study.id === editingStudy.id 
                  ? { ...formData, id: editingStudy.id }
                  : study
              ));
              setEditingStudy(null);
            } else {
              const newStudy = {
                ...formData,
                id: generateId()
              };
              setStudies(prev => [...prev, newStudy]);
            }

            setFormData({
              fecha: new Date().toISOString().split('T')[0],
              admision: '',
              id: '',
              nombres: '',
              apellidos: '',
              edad: '',
              estudio: '',
              dxEst: '',
              fechaRealizacion: new Date().toISOString().split('T')[0],
              hora: '08:00',
              dia: '',
              drLector: '',
              sinInforme: false,
              articular: '',
              kristalo: '',
              synapse: '',
              solicitudes: '',
              acciones: ''
            });
            setShowAddForm(false);
          };

          const handleEdit = (study) => {
            setFormData(study);
            setEditingStudy(study);
            setShowAddForm(true);
          };

          const handleDelete = (id) => {
            if (window.confirm('¿Está seguro de eliminar este estudio?')) {
              setStudies(prev => prev.filter(study => study.id !== id));
            }
          };

          const exportData = () => {
            const dataStr = JSON.stringify(studies, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'estudios_medicos.json';
            link.click();
          };

          // Exportar a Excel
          const exportToExcel = useCallback(() => {
            try {
              const worksheet = XLSX.utils.json_to_sheet(studies);
              const workbook = XLSX.utils.book_new();
              XLSX.utils.book_append_sheet(workbook, worksheet, 'Estudios Médicos');
              XLSX.writeFile(workbook, 'estudios_medicos.xlsx');
            } catch (error) {
              console.error('Error exportando a Excel:', error);
              alert('Error al exportar a Excel');
            }
          }, [studies]);

          // Función para procesar archivo Excel
          const handleFileUpload = (e) => {
            const file = e.target.files[0];
            if (!file) return;
            
            setImportStatus('Procesando archivo...');
            setIsLoading(true);
            
            const reader = new FileReader();
            reader.onload = function(e) {
              try {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                
                const sheetName = workbook.SheetNames[0];
                const sheet = workbook.Sheets[sheetName];
                const jsonData = XLSX.utils.sheet_to_json(sheet);
                
                if (jsonData.length > 0) {
                  const processedData = jsonData.map(item => ({
                    id: generateId(),
                    fecha: item.fecha || new Date().toISOString().split('T')[0],
                    admision: item.admision || '',
                    nombres: item.nombres || '',
                    apellidos: item.apellidos || '',
                    edad: item.edad || '',
                    estudio: item.estudio || '',
                    dxEst: item.dxEst || '',
                    fechaRealizacion: item.fechaRealizacion || new Date().toISOString().split('T')[0],
                    hora: item.hora || '08:00',
                    dia: item.dia || '',
                    drLector: item.drLector || '',
                    sinInforme: item.sinInforme || false,
                    articular: item.articular || '',
                    kristalo: item.kristalo || '',
                    synapse: item.synapse || '',
                    solicitudes: item.solicitudes || '',
                    acciones: item.acciones || ''
                  }));
                  
                  setStudies(prev => [...prev, ...processedData]);
                  setImportStatus(`✅ Se importaron ${processedData.length} estudios correctamente.`);
                  e.target.value = '';
                } else {
                  setImportStatus('❌ El archivo no contiene datos válidos.');
                }
              } catch (error) {
                console.error('Error al procesar el archivo:', error);
                setImportStatus('❌ Error al procesar el archivo. Asegúrese de que es un Excel válido.');
              } finally {
                setIsLoading(false);
              }
            };
            
            reader.onerror = function() {
              setImportStatus('❌ Error al leer el archivo.');
              setIsLoading(false);
            };
            
            reader.readAsArrayBuffer(file);
          };

          // Función para descargar plantilla
          const downloadTemplate = () => {
            const templateData = [
              {
                fecha: '2023-10-15',
                admision: 'A12345',
                nombres: 'María',
                apellidos: 'González',
                edad: '45',
                estudio: 'RX TORAX',
                dxEst: 'Diagnóstico ejemplo',
                fechaRealizacion: '2023-10-15',
                hora: '09:30',
                drLector: 'DR COLON',
                sinInforme: false,
                kristalo: 'K123',
                synapse: 'S456'
              }
            ];
            
            const worksheet = XLSX.utils.json_to_sheet(templateData);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, 'Plantilla');
            XLSX.writeFile(workbook, 'plantilla_estudios.xlsx');
          };

          // Cálculos optimizados con useMemo
          const filteredStudies = useMemo(() => {
            if (!searchTerm && !filterType) return studies;
            
            return studies.filter(study => {
              const matchesSearch = searchTerm ? 
                Object.values(study).some(value => 
                  value && value.toString().toLowerCase().includes(searchTerm.toLowerCase())
                ) : true;
              
              const matchesFilter = filterType ? study.estudio === filterType : true;
              
              return matchesSearch && matchesFilter;
            });
          }, [studies, searchTerm, filterType]);

          // Estadísticas
          const stats = useMemo(() => {
            const total = studies.length;
            const withReport = studies.filter(s => !s.sinInforme).length;
            const withoutReport = studies.filter(s => s.sinInforme).length;
            
            const studyCounts = {};
            studies.forEach(study => {
              studyCounts[study.estudio] = (studyCounts[study.estudio] || 0) + 1;
            });
            
            const mostCommonStudy = Object.entries(studyCounts)
              .sort((a, b) => b[1] - a[1])
              [0] || ['N/A', 0];
            
            return {
              total,
              withReport,
              withoutReport,
              mostCommonStudy: `${mostCommonStudy[0]} (${mostCommonStudy[1]})`
            };
          }, [studies]);

          // Paginación
          const indexOfLastStudy = currentPage * studiesPerPage;
          const indexOfFirstStudy = indexOfLastStudy - studiesPerPage;
          const currentStudies = filteredStudies.slice(indexOfFirstStudy, indexOfLastStudy);
          const totalPages = Math.ceil(filteredStudies.length / studiesPerPage);

          if (isLoading) {
            return <div className="loading">Cargando estudios médicos...</div>;
          }

          return (
            <div className="min-h-screen bg-gray-50 p-4 md:p-6">
              <div className="max-w-7xl mx-auto">
                {/* Header */}
                <div className="header-bg text-white p-4 rounded-t-lg shadow-md">
                  <h1 className="text-2xl font-bold flex items-center gap-2">
                    <Icon name="FileText" size={24} />
                    Sistema de Gestión de Estudios Médicos
                    <span className="text-sm font-normal ml-auto">
                      {studies.length} registros cargados
                    </span>
                  </h1>
                </div>

                {/* Toolbar */}
                <div className="bg-white p-4 border-x border-gray-200 flex flex-wrap gap-4 items-center shadow-sm">
                  <button
                    onClick={() => setShowAddForm(true)}
                    className="btn-primary text-white px-4 py-2 rounded flex items-center gap-2"
                  >
                    <Icon name="Plus" size={16} />
                    Nuevo Estudio
                  </button>
                  
                  <button
                    onClick={exportData}
                    className="btn-secondary text-white px-4 py-2 rounded flex items-center gap-2"
                  >
                    <Icon name="Download" size={16} />
                    Exportar JSON
                  </button>

                  <button
                    onClick={exportToExcel}
                    className="export-btn text-white px-4 py-2 rounded flex items-center gap-2"
                  >
                    <Icon name="Download" size={16} />
                    Exportar Excel
                  </button>

                  <button
                    onClick={() => setShowImportSection(!showImportSection)}
                    className="btn-tertiary text-white px-4 py-2 rounded flex items-center gap-2"
                  >
                    <Icon name="Upload" size={16} />
                    Importar
                  </button>

                  <button
                    onClick={() => setShowStats(!showStats)}
                    className="bg-purple-600 text-white px-4 py-2 rounded flex items-center gap-2 hover:bg-purple-700"
                  >
                    <Icon name="BarChart" size={16} />
                    Estadísticas
                  </button>

                  <div className="flex items-center gap-2">
                    <Icon name="Search" size={16} className="text-gray-500" />
                    <input
                      type="text"
                      placeholder="Buscar..."
                      value={searchTerm}
                      onChange={(e) => setSearchTerm(e.target.value)}
                      className="border border-gray-300 px-3 py-2 rounded w-full md:w-64"
                    />
                  </div>

                  <div className="flex items-center gap-2">
                    <Icon name="Filter" size={16} className="text-gray-500" />
                    <select
                      value={filterType}
                      onChange={(e) => setFilterType(e.target.value)}
                      className="border border-gray-300 px-3 py-2 rounded"
                    >
                      <option value="">Todos los estudios</option>
                      {studyTypes.map(type => (
                        <option key={type} value={type}>{type}</option>
                      ))}
                    </select>
                  </div>

                  <div className="flex items-center gap-2">
                    <span className="text-sm text-gray-600">Mostrar:</span>
                    <select 
                      value={studiesPerPage} 
                      onChange={(e) => {
                        setStudiesPerPage(Number(e.target.value));
                        setCurrentPage(1);
                      }}
                      className="border border-gray-300 px-2 py-1 rounded"
                    >
                      <option value="10">10</option>
                      <option value="25">25</option>
                      <option value="50">50</option>
                      <option value="100">100</option>
                    </select>
                  </div>

                  <div className="text-sm text-gray-600 ml-auto">
                    Filtrados: {filteredStudies.length}
                  </div>
                </div>

                {/* Estadísticas */}
                {showStats && (
                  <div className="bg-white p-4 border-x border-gray-200 grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div className="stats-card">
                      <div className="text-2xl font-bold text-green-600">{stats.total}</div>
                      <div className="text-sm text-gray-600">Total estudios</div>
                    </div>
                    <div className="stats-card">
                      <div className="text-2xl font-bold text-blue-600">{stats.withReport}</div>
                      <div className="text-sm text-gray-600">Con informe</div>
                    </div>
                    <div className="stats-card">
                      <div className="text-2xl font-bold text-red-600">{stats.withoutReport}</div>
                      <div className="text-sm text-gray-600">Sin informe</div>
                    </div>
                    <div className="stats-card">
                      <div className="text-lg font-bold text-purple-600">{stats.mostCommonStudy}</div>
                      <div className="text-sm text-gray-600">Estudio más común</div>
                    </div>
                  </div>
                )}

                {/* Sección de importación */}
                {showImportSection && (
                  <div className="import-section">
                    <h3 className="text-lg font-semibold mb-2">Importar estudios desde Excel</h3>
                    <p className="text-sm text-gray-600 mb-4">
                      Seleccione un archivo Excel con los campos requeridos. 
                      <span className="template-download ml-1" onClick={downloadTemplate}>
                        Descargar plantilla
                      </span>
                    </p>
                    
                    <div className="file-input-container">
                      <button className="btn-primary text-white px-4 py-2 rounded flex items-center gap-2">
                        <Icon name="Upload" size={16} />
                        Seleccionar archivo Excel
                      </button>
                      <input 
                        type="file" 
                        accept=".xlsx, .xls, .csv"
                        onChange={handleFileUpload}
                      />
                    </div>
                    
                    {importStatus && (
                      <div className={`mt-3 p-2 rounded text-sm ${importStatus.includes('✅') ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>
                        {importStatus}
                      </div>
                    )}
                  </div>
                )}

                {/* Formulario */}
                {showAddForm && (
                  <div className="bg-white border-x border-gray-200 p-4 shadow-md">
                    <h3 className="text-lg font-semibold mb-4">
                      {editingStudy ? 'Editar Estudio' : 'Agregar Nuevo Estudio'}
                    </h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                      {/* Campos del formulario (igual que antes) */}
                      <div>
                        <label className="block text-sm font-medium mb-1">Fecha *</label>
                        <input
                          type="date"
                          name="fecha"
                          value={formData.fecha}
                          onChange={handleInputChange}
                          className="w-full border border-gray-300 px-3 py-2 rounded"
                          required
                        />
                      </div>

                      <div>
                        <label className="block text-sm font-medium mb-1">Admisión</label>
                        <input
                          type="text"
                          name="admision"
                          value={formData.admision}
                          onChange={handleInputChange}
                          className="w-full border border-gray-300 px-3 py-2 rounded"
                        />
                      </div>

                      <div>
                        <label className="block text-sm font-medium mb-1">Nombres *</label>
                        <input
                          type="text"
                          name="nombres"
                          value={formData.nombres}
                          onChange={handleInputChange}
                          className="w-full border border-gray-300 px-3 py-2 rounded"
                          required
                        />
                      </div>

                      <div>
                        <label className="block text-sm font-medium mb-1">Apellidos *</label>
                        <input
                          type="text"
                          name="apellidos"
                          value={formData.apellidos}
                          onChange={handleInputChange}
                          className="w-full border border-gray-300 px-3 py-2 rounded"
                          required
                        />
                      </div>

                      <div>
                        <label className="block text-sm font-medium mb-1">Edad</label>
                        <input
                          type="number"
                          name="edad"
                          value={formData.edad}
                          onChange={handleInputChange}
                          className="w-full border border-gray-300 px-3 py-2 rounded"
                        />
                      </div>

                      <div>
                        <label className="block text-sm font-medium mb-1">Estudio *</label>
                        <select
                          name="estudio"
                          value={formData.estudio}
                          onChange={handleInputChange}
                          className="w-full border border-gray-300 px-3 py-2 rounded"
                          required
                        >
                          <option value="">Seleccionar...</option>
                          {studyTypes.map(type => (
                            <option key={type} value={type}>{type}</option>
                          ))}
                        </select>
                      </div>

                      <div>
                        <label className="block text-sm font-medium mb-1">Fecha Realización</label>
                        <input
                          type="date"
                          name="fechaRealizacion"
                          value={formData.fechaRealizacion}
                          onChange={handleInputChange}
                          className="w-full border border-gray-300 px-3 py-2 rounded"
                        />
                      </div>

                      <div>
                        <label className="block text-sm font-medium mb-1">Hora</label>
                        <input
                          type="time"
                          name="hora"
                          value={formData.hora}
                          onChange={handleInputChange}
                          className="w-full border border-gray-300 px-3 py-2 rounded"
                        />
                      </div>

                      <div>
                        <label className="block text-sm font-medium mb-1">Dr. Lector</label>
                        <select
                          name="drLector"
                          value={formData.drLector}
                          onChange={handleInputChange}
                          className="w-full border border-gray-300 px-3 py-2 rounded"
                        >
                          <option value="">Seleccionar...</option>
                          {doctors.map(doctor => (
                            <option key={doctor} value={doctor}>{doctor}</option>
                          ))}
                        </select>
                      </div>

                      <div>
                        <label className="block text-sm font-medium mb-1">Kristalo</label>
                        <input
                          type="text"
                          name="kristalo"
                          value={formData.kristalo}
                          onChange={handleInputChange}
                          className="w-full border border-gray-300 px-3 py-2 rounded"
                        />
                      </div>

                      <div>
                        <label className="block text-sm font-medium mb-1">Synapse</label>
                        <input
                          type="text"
                          name="synapse"
                          value={formData.synapse}
                          onChange={handleInputChange}
                          className="w-full border border-gray-300 px-3 py-2 rounded"
                        />
                      </div>

                      <div className="flex items-center gap-2">
                        <input
                          type="checkbox"
                          name="sinInforme"
                          checked={formData.sinInforme}
                          onChange={handleInputChange}
                          className="w-4 h-4"
                        />
                        <label className="text-sm font-medium">Sin Informe</label>
                      </div>

                      <div className="md:col-span-3 flex gap-2 pt-4">
                        <button
                          type="button"
                          onClick={handleSubmit}
                          className="btn-primary text-white px-4 py-2 rounded flex items-center gap-2"
                        >
                          <Icon name="Save" size={16} />
                          {editingStudy ? 'Actualizar' : 'Guardar'}
                        </button>
                        <button
                          type="button"
                          onClick={() => {
                            setShowAddForm(false);
                            setEditingStudy(null);
                            setFormData({
                              fecha: new Date().toISOString().split('T')[0],
                              admision: '', id: '', nombres: '', apellidos: '', edad: '',
                              estudio: '', dxEst: '', fechaRealizacion: new Date().toISOString().split('T')[0],
                              hora: '08:00', dia: '', drLector: '', sinInforme: false, 
                              articular: '', kristalo: '', synapse: '', solicitudes: '', acciones: ''
                            });
                          }}
                          className="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600"
                        >
                          Cancelar
                        </button>
                      </div>
                    </div>
                  </div>
                )}

                {/* Tabla */}
                <div className="bg-white border rounded-b-lg overflow-hidden shadow-md">
                  <div className="overflow-x-auto">
                    <table className="w-full text-sm">
                      <thead className="bg-gray-50">
                        <tr>
                          <th className="px-4 py-3 text-left">Fecha</th>
                          <th className="px-4 py-3 text-left">Admisión</th>
                          <th className="px-4 py-3 text-left">Paciente</th>
                          <th className="px-4 py-3 text-left">Edad</th>
                          <th className="px-4 py-3 text-left">Estudio</th>
                          <th className="px-4 py-3 text-left">F. Realización</th>
                          <th className="px-4 py-3 text-left">Dr. Lector</th>
                          <th className="px-4 py-3 text-left">Informe</th>
                          <th className="px-4 py-3 text-left">Acciones</th>
                        </tr>
                      </thead>
                      <tbody>
                        {currentStudies.map((study) => (
                          <tr key={study.id} className="table-row hover:bg-gray-50">
                            <td className="px-4 py-3">{study.fecha}</td>
                            <td className="px-4 py-3">{study.admision}</td>
                            <td className="px-4 py-3">{study.nombres} {study.apellidos}</td>
                            <td className="px-4 py-3">{study.edad}</td>
                            <td className="px-4 py-3">
                              <span className="status-badge bg-blue-100 text-blue-800">
                                {study.estudio}
                              </span>
                            </td>
                            <td className="px-4 py-3">{study.fechaRealizacion} {study.hora && `- ${study.hora}`}</td>
                            <td className="px-4 py-3">{study.drLector}</td>
                            <td className="px-4 py-3">
                              {study.sinInforme ? 
                                <span className="status-badge no-report">NO TIENE</span> : 
                                <span className="status-badge has-report">TIENE</span>
                              }
                            </td>
                            <td className="px-4 py-3">
                              <div className="flex gap-2">
                                <button
                                  onClick={() => handleEdit(study)}
                                  className="text-blue-600 hover:text-blue-800 transition-colors"
                                  title="Editar"
                                >
                                  <Icon name="Edit" size={16} />
                                </button>
                                <button
                                  onClick={() => handleDelete(study.id)}
                                  className="text-red-600 hover:text-red-800 transition-colors"
                                  title="Eliminar"
                                >
                                  <Icon name="Trash2" size={16} />
                                </button>
                              </div>
                            </td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>

                  {filteredStudies.length === 0 && (
                    <div className="text-center py-8 text-gray-500">
                      No se encontraron estudios
                    </div>
                  )}
                </div>

                {/* Paginación */}
                {totalPages > 1 && (
                  <div className="bg-white border-t p-4 flex flex-col md:flex-row justify-between items-center gap-4">
                    <div className="text-sm text-gray-600">
                      Mostrando {indexOfFirstStudy + 1} a {Math.min(indexOfLastStudy, filteredStudies.length)} de {filteredStudies.length} estudios
                    </div>
                    <div className="flex gap-2">
                      <button
                        onClick={() => setCurrentPage(prev => Math.max(prev - 1, 1))}
                        disabled={currentPage === 1}
                        className="px-3 py-1 border rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100"
                      >
                        Anterior
                      </button>
                      <span className="px-3 py-1 bg-green-600 text-white rounded">
                        {currentPage} de {totalPages}
                      </span>
                      <button
                        onClick={() => setCurrentPage(prev => Math.min(prev + 1, totalPages))}
                        disabled={currentPage === totalPages}
                        className="px-3 py-1 border rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100"
                      >
                        Siguiente
                      </button>
                    </div>
                  </div>
                )}
              </div>
            </div>
          );
        };

        // Usar createRoot para React 18
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MedicalStudiesApp />);
    </script>
</body>
</html>